# Touch Down Card Game - 개발 가이드

## 🚀 빠른 시작

### 1. 프로젝트 설정
```bash
# 저장소 클론
git clone https://github.com/dev-Rluan/touch_down_card_game.git
cd touch_down_card_game

# 의존성 설치
npm install

# 개발 서버 시작
npm run dev
```

### 2. 접속 확인
- 서버: `http://localhost:3000`
- 개발자 도구에서 Socket.IO 연결 확인

## 🏗️ 프로젝트 구조

### 핵심 파일들
```
src/
├── server.js              # 메인 서버 파일 (server_improved.js 사용)
├── services/
│   ├── roomService.js     # 방 관리 로직
│   ├── userServices.js    # 사용자 관리
│   └── gameService.js      # 게임 로직
├── public/js/app.js        # 클라이언트 JavaScript
└── view/index.html        # 메인 페이지
```

### 문서 파일들
```
docs/
├── API_통신_규격_문서.md    # Socket.IO 이벤트 명세
├── 소프트웨어_스펙_문서.md   # 전체 시스템 스펙
└── 개발가이드.md            # 이 파일
```

## 🛠️ 개발 환경

### 필수 요구사항
- Node.js 18.0.0 이상
- npm 8.0.0 이상
- Git

### 권장 IDE 설정
- VS Code + Socket.IO 확장
- ESLint 확장
- Prettier 확장

### 환경 변수
```bash
# .env 파일 생성
NODE_ENV=development
PORT=3000
LOG_LEVEL=debug
```

## 📝 코딩 규칙

### 1. 함수 작성 규칙
```javascript
/**
 * 방 생성 함수
 * @param {string} socketId - 소켓 ID
 * @param {string} roomName - 방 이름
 * @param {number} maxUserCnt - 최대 인원수
 * @returns {Object} 생성된 방 정보
 * @throws {Error} 방 이름 중복 또는 유효하지 않은 입력값
 */
function createRoom(socketId, roomName, maxUserCnt) {
  // 입력값 검증
  if (!socketId || !roomName || !roomName.trim()) {
    throw new Error("필수 입력값이 누락되었습니다.");
  }
  
  // 함수 구현
  // ...
}
```

### 2. 에러 처리 규칙
```javascript
// ✅ 좋은 예
try {
  const room = roomService.createRoom(socketId, roomName, maxCnt);
  socket.emit('roomCreated', room);
} catch (error) {
  console.error('[createRoom Error]', error);
  socket.emit('createRoomError', error.message);
}

// ❌ 나쁜 예
const room = roomService.createRoom(socketId, roomName, maxCnt);
socket.emit('roomCreated', room);
```

### 3. 로깅 규칙
```javascript
// 로그 레벨별 사용
console.log('[Info]', '사용자 연결:', socket.id);
console.warn('[Warning]', '방 인원 초과');
console.error('[Error]', '방 생성 실패:', error.message);
console.debug('[Debug]', '방 목록:', roomList);
```

## 🔧 개발 워크플로우

### 1. 기능 개발 과정
1. **이슈 생성**: GitHub Issues에서 작업 항목 생성
2. **브랜치 생성**: `feature/기능명` 브랜치 생성
3. **개발**: 기능 구현 및 테스트
4. **커밋**: 명확한 커밋 메시지 작성
5. **PR 생성**: Pull Request 생성 및 리뷰 요청
6. **병합**: 리뷰 완료 후 main 브랜치 병합

### 2. 브랜치 전략
```
main (프로덕션)
├── develop (개발)
├── feature/room-management
├── feature/game-logic
├── bugfix/connection-issue
└── hotfix/critical-bug
```

### 3. 커밋 메시지 규칙
```
feat: 방 생성 기능 추가
fix: 연결 해제 시 메모리 누수 수정
docs: API 문서 업데이트
style: 코드 포맷팅 수정
refactor: roomService 리팩토링
test: 방 관리 테스트 추가
chore: 의존성 업데이트
```

## 🧪 테스트 가이드

### 1. 단위 테스트 작성
```javascript
// tests/unit/services/roomService.test.js
describe('roomService', () => {
  describe('createRoom', () => {
    it('should create room with valid input', () => {
      const socketId = 'test-socket-id';
      const roomName = '테스트방';
      const maxUserCnt = 4;
      
      const room = roomService.createRoom(socketId, roomName, maxUserCnt);
      
      expect(room).toBeDefined();
      expect(room.name).toBe(roomName);
      expect(room.maxUserCnt).toBe(maxUserCnt);
    });
    
    it('should throw error with invalid input', () => {
      expect(() => {
        roomService.createRoom('', '방이름', 4);
      }).toThrow('필수 입력값이 누락되었습니다.');
    });
  });
});
```

### 2. 통합 테스트 작성
```javascript
// tests/integration/socket.test.js
describe('Socket.IO Integration', () => {
  it('should handle room creation flow', (done) => {
    const client = io('http://localhost:3000');
    
    client.emit('createRoom', '테스트방', 4);
    
    client.on('roomCreated', (room) => {
      expect(room.name).toBe('테스트방');
      client.disconnect();
      done();
    });
  });
});
```

## 🚀 배포 가이드

### 1. 프로덕션 빌드
```bash
# 의존성 설치 (프로덕션만)
npm ci --only=production

# 서버 시작
npm start
```

### 2. Docker 배포
```dockerfile
# Dockerfile
FROM node:18-alpine
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production
COPY . .
EXPOSE 3000
CMD ["npm", "start"]
```

### 3. 환경별 설정
```javascript
// config/production.js
module.exports = {
  port: process.env.PORT || 3000,
  logging: {
    level: 'info'
  },
  database: {
    // 프로덕션 DB 설정
  }
};
```

## 📊 모니터링 및 디버깅

### 1. 로그 확인
```bash
# 실시간 로그 확인
tail -f logs/combined.log

# 에러 로그만 확인
tail -f logs/error.log
```

### 2. 성능 모니터링
```javascript
// utils/metrics.js
const metrics = {
  activeConnections: 0,
  roomsCreated: 0,
  gamesPlayed: 0,
  averageGameTime: 0
};

// 메트릭 업데이트
function updateMetrics(type, value) {
  metrics[type] = value;
  console.log('[Metrics]', metrics);
}
```

### 3. 디버깅 팁
- **연결 문제**: Socket.IO 연결 상태 확인
- **방 관리**: 방 목록과 사용자 상태 확인
- **게임 로직**: 게임 상태 전환 확인
- **메모리 누수**: 연결 해제 시 정리 로직 확인

## 🔍 문제 해결

### 자주 발생하는 문제들

#### 1. 연결 문제
```javascript
// 문제: 클라이언트가 서버에 연결되지 않음
// 해결: 포트 확인 및 방화벽 설정
console.log('서버 포트:', PORT);
console.log('연결 상태:', socket.connected);
```

#### 2. 방 관리 문제
```javascript
// 문제: 방이 생성되지 않음
// 해결: 입력값 검증 및 에러 로그 확인
if (!roomName || !roomName.trim()) {
  console.error('방 이름이 유효하지 않습니다:', roomName);
  return;
}
```

#### 3. 메모리 누수
```javascript
// 문제: 사용자 연결 해제 시 메모리 누수
// 해결: 적절한 정리 로직 구현
socket.on('disconnect', () => {
  // 사용자 정보 정리
  userService.disconnectUser(socket.id);
  
  // 방에서 사용자 제거
  const room = roomService.getRoomByUser(socket.id);
  if (room) {
    roomService.leaveRoom(socket.id, room.id);
  }
});
```

## 📚 추가 자료

### 참고 문서
- [Socket.IO 공식 문서](https://socket.io/docs/)
- [Express.js 가이드](https://expressjs.com/guide/)
- [Node.js 모범 사례](https://nodejs.org/en/docs/guides/)

### 유용한 도구
- **Postman**: API 테스트
- **Socket.IO Client**: 클라이언트 테스트
- **Chrome DevTools**: 디버깅
- **VS Code**: 개발 환경

이 가이드를 따라 개발하면 효율적이고 안정적인 코드를 작성할 수 있습니다! 🚀
