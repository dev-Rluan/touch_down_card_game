# Touch Down Card Game - 소프트웨어 스펙 문서

## 1. 프로젝트 개요

### 1.1 프로젝트명
- **Touch Down Card Game** (온라인 할리갈리 게임)

### 1.2 프로젝트 설명
- 실시간 멀티플레이어 카드 게임
- 할리갈리(Halli Galli) 게임의 온라인 버전
- WebSocket 기반 실시간 통신으로 구현

### 1.3 주요 기능
- **게임 기능**: 같은 과일의 개수가 정확히 5개일 때 벨을 쳐서 카드 획득
- **방 관리**: 게임 방 생성, 입장, 나가기, 최대 인원 설정
- **턴 기반 진행**: 순서대로 카드를 뒤집으며 진행
- **할리갈리 시스템**: 성공/실패에 따른 카드 획득 및 페널티
- **실시간 동기화**: Socket.IO 기반 즉각적인 상태 업데이트
- **게임 타이머**: 게임 시작 전 카운트다운 및 턴 제한

## 2. 기술 스택

### 2.1 백엔드
- **Node.js**: JavaScript 런타임
- **Express.js**: 웹 서버 프레임워크
- **Socket.IO**: 실시간 양방향 통신
- **UUID**: 고유 식별자 생성

### 2.2 프론트엔드
- **HTML5**: 마크업 언어
- **CSS3**: 스타일링
- **JavaScript (ES6+)**: 클라이언트 사이드 로직
- **Bootstrap**: UI 프레임워크

### 2.3 개발 도구
- **Babel**: JavaScript 트랜스파일러
- **Nodemon**: 개발 서버 자동 재시작

## 3. 시스템 아키텍처

### 3.1 전체 구조
```
src/
├── server.js              # 메인 서버 파일
├── cardGame.js           # 게임 로직
├── config/               # 설정 파일들
├── controllers/          # 컨트롤러 (비즈니스 로직)
├── models/              # 데이터 모델
├── services/            # 서비스 레이어
├── socket/              # Socket.IO 이벤트 핸들러
├── utils/               # 유틸리티 함수
├── view/                # HTML 뷰 파일
└── public/              # 정적 파일 (CSS, JS, 이미지)
```

### 3.2 아키텍처 패턴
- **MVC 패턴**: Model-View-Controller 구조
- **서비스 레이어**: 비즈니스 로직 분리
- **이벤트 기반**: Socket.IO를 통한 실시간 이벤트 처리

## 4. 데이터 모델

### 4.1 Card 모델
```javascript
class Card {
  constructor(fruit, count) {
    this.fruit = fruit;    // 과일 종류 (strawberry, banana, plum, lemon)
    this.count = count;    // 카드에 그려진 과일 개수 (1-5)
  }
}
```

### 4.2 User 모델
```javascript
class User {
  constructor(id, socketId, name) {
    this.id = id;                    // 유저 고유 ID
    this.socketId = socketId;        // Socket ID
    this.name = name;                // 닉네임
    this.score = 0;                  // 점수
    this.readyStatus = false;        // 준비 상태
    this.manager = false;            // 방장 여부
    this.cardPack = [];              // 보유 카드
  }
}
```

### 4.3 Room 모델
```javascript
class Room {
  constructor(id, name, maxUserCount) {
    this.id = id;                    // 방 고유 ID
    this.name = name;                // 방 이름
    this.maxUserCount = maxUserCount; // 최대 인원수
    this.users = [];                 // 방에 있는 유저들
    this.status = 'waiting';         // 방 상태
    this.game = null;                // 게임 정보
  }
}
```

### 4.4 Game State 모델
```javascript
gameState: {
  phase: 'playing',                // 게임 단계 (playing, finished)
  currentTurn: 0,                  // 현재 턴 인덱스
  centerCards: [],                 // 전체 중앙 카드 (히스토리용)
  playerStacks: {                  // 플레이어별 카드 스택
    'playerId1': [card1, card2],   // 각 플레이어의 카드 더미
    'playerId2': [card3, card4]
  },
  discardedCards: [],              // 할리갈리 실패 시 버린 카드들
  remainingDeck: 0,                // 남은 덱 카드 수
  gameStartTime: '...',            // 게임 시작 시간
  lastActionTime: '...'            // 마지막 액션 시간
}
```

## 5. API 및 이벤트

### 5.1 Socket.IO 이벤트

#### 5.1.1 사용자 관련 이벤트
- `connecting`: 클라이언트 연결 시
- `change name`: 닉네임 변경
- `name change successful`: 닉네임 변경 성공

#### 5.1.2 방 관련 이벤트
- `createRoom`: 방 생성
- `roomCreated`: 방 생성 성공
- `createRoomError`: 방 생성 실패
- `joinRoom`: 방 입장
- `successJoinRoom`: 방 입장 성공
- `faildJoinRoom`: 방 입장 실패
- `leaveRoom`: 방 나가기
- `leaveRoomResult`: 방 나가기 결과
- `roomList`: 방 목록 조회

#### 5.1.3 게임 관련 이벤트
- `ready`: 준비 상태 변경
- `updateReadyStatus`: 준비 상태 업데이트
- `gameCountdownStart`: 게임 시작 카운트다운 시작
- `gameCountdown`: 카운트다운 진행 (3, 2, 1)
- `gameCountdownCanceled`: 카운트다운 취소 (준비 해제 시)
- `gameStart`: 게임 시작
- `yourHand`: 개별 플레이어에게 카드 전송
- `playCard`: 카드 내기
- `cardPlayed`: 카드 내기 완료
- `gameState`: 게임 상태 업데이트
- `halliGalli`: 할리갈리 시도
- `halliGalliResult`: 할리갈리 결과 (성공/실패)
- `gameEnd`: 게임 종료

#### 5.1.4 채팅 관련 이벤트
- `chat message`: 채팅 메시지

### 5.2 HTTP 라우트
- `GET /`: 메인 페이지

## 6. 게임 규칙

### 6.1 기본 규칙
- **카드 구성**: 4종류의 과일(🍓딸기, 🍌바나나, 🍇자두, 🍋레몬) × 1~5개씩, 총 56장
- **게임 목표**: 각 플레이어의 맨 위 카드를 보고 같은 과일의 개수가 정확히 5개일 때 벨을 쳐서 카드 획득
- **승리 조건**: 한 명을 제외한 모든 플레이어의 카드가 0이 되면 게임 종료, 가장 많은 카드를 보유한 플레이어 승리

### 6.2 카드 분배
- 1개짜리: 5장
- 2개짜리: 3장  
- 3개짜리: 3장
- 4개짜리: 2장
- 5개짜리: 1장
- **총 14장 × 4종류 = 56장**

### 6.3 할리갈리 규칙
#### 성공 시
- 중앙에 쌓인 모든 카드 획득
- 버림 카드 더미의 모든 카드 획득
- 획득한 카드를 섞어서 자신의 덱 맨 아래에 추가
- 점수 증가 (획득한 카드 수만큼)

#### 실패 시
- 자신의 덱에서 맨 아래 카드 1장 제거
- 제거한 카드를 버림 카드 더미에 추가
- 버림 카드는 할리갈리 조건 체크에 영향 없음

## 7. 주요 기능 상세

### 7.1 방 관리 기능
- **방 생성**: 방 이름, 최대 인원수 설정
- **방 입장**: 대기 중인 방에 입장
- **방 나가기**: 현재 방에서 나가기
- **방 목록**: 대기 중인 방 목록 조회

### 7.2 게임 진행 기능
- **준비 상태**: 모든 플레이어가 준비하면 3초 카운트다운 후 게임 시작
- **카드 분배**: 56장의 카드를 플레이어들에게 균등하게 분배
- **턴 진행**: 순서대로 카드를 뒤집어 중앙에 놓기
- **플레이어 스택**: 각 플레이어별로 카드 더미 관리
- **할리갈리 체크**: 각 플레이어의 맨 위 카드만 보고 판단
- **카드 획득**: 성공 시 모든 카드 섞어서 덱에 추가
- **버림 카드**: 실패 시 페널티 카드를 별도 공간에 관리
- **게임 종료**: 승리 조건 달성 시 결과 화면 표시

### 7.3 실시간 통신 기능
- **WebSocket**: 실시간 양방향 통신
- **이벤트 기반**: 게임 상태 변화를 실시간으로 전송
- **방 단위 통신**: 같은 방의 플레이어들만 통신

## 8. 보안 및 성능

### 8.1 보안 고려사항
- **입력 검증**: 사용자 입력에 대한 유효성 검사
- **에러 처리**: 예외 상황에 대한 적절한 처리
- **방 인원 제한**: 최대 인원수 초과 방지

### 8.2 성능 최적화
- **메모리 관리**: 불필요한 객체 정리
- **이벤트 최적화**: 필요한 이벤트만 전송
- **방 상태 관리**: 효율적인 방 상태 업데이트

## 9. 배포 및 운영

### 9.1 환경 설정
- **개발 환경**: `npm run dev` (nodemon 사용)
- **포트**: 기본 3000번 포트
- **환경 변수**: NODE_ENV에 따른 설정 분리

### 9.2 의존성
```json
{
  "devDependencies": {
    "@babel/cli": "^7.21.0",
    "@babel/core": "^7.21.0",
    "@babel/node": "^7.20.7",
    "@babel/preset-env": "^7.20.2",
    "express": "^4.18.2",
    "nodemon": "^2.0.20",
    "socket.io": "^4.6.1",
    "uuid": "^9.0.0"
  }
}
```

## 10. 구현 완료 기능 (v1.0.0)

### 10.1 게임 시스템
- ✅ 카드 분배 및 게임 시작
- ✅ 턴 기반 카드 내기
- ✅ 할리갈리 성공/실패 로직
- ✅ 버림 카드 시스템
- ✅ 카드 획득 및 섞기
- ✅ 게임 종료 및 승자 결정
- ✅ 실시간 게임 상태 동기화

### 10.2 UI/UX
- ✅ 게임 보드 (플레이어별 카드 스택)
- ✅ 할리갈리 벨 버튼 (애니메이션 포함)
- ✅ 카운트다운 타이머
- ✅ 현재 턴 표시
- ✅ 카드 개수 실시간 업데이트
- ✅ 할리갈리 성공/실패 알림
- ✅ 게임 종료 모달 (승리/패배)
- ✅ 사운드 효과 (벨 소리)

### 10.3 향후 개선 사항
- **관전자 모드**: 게임 관전 기능
- **리플레이**: 게임 다시보기
- **통계**: 승률, 게임 기록 등
- **데이터베이스**: 사용자 및 게임 데이터 저장
- **인증 시스템**: 로그인/회원가입
- **친구 시스템**: 친구 추가 및 초대
- **커스텀 룰**: 게임 규칙 커스터마이징

## 11. 결론

Touch Down Card Game (v1.0.0)은 실시간 멀티플레이어 카드 게임으로, Socket.IO를 활용한 실시간 통신과 MVC 패턴을 적용한 구조화된 코드로 구현되었습니다. 

**주요 완성 사항:**
- ✅ 완전한 게임 로직 구현
- ✅ 실시간 멀티플레이어 게임 진행
- ✅ 할리갈리 시스템 (성공/실패)
- ✅ 직관적인 UI/UX
- ✅ 사운드 및 애니메이션 효과
- ✅ 게임 종료 및 승자 결정

현재 플레이 가능한 게임으로, 추가 기능(관전 모드, 통계, 데이터베이스 등)을 통해 더욱 발전시킬 수 있습니다.

---

**마지막 업데이트**: 2025-10-24
**버전**: 1.0.0
